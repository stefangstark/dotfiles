#!/usr/bin/env bash
set -euo pipefail

window=$(yabai -m query --windows | jq 'map(select(.app == "WezTerm" or .app == "wezterm-gui")) | sort_by(.id) | last')
is_visible=$(echo "$window" | jq '."is-visible"')
id=$(echo "$window" | jq '.id')

# test if window was found, if not, open the app
if [ "$window" = "null" ]; then
  # wezterm --config 'color_scheme="Batman"' &
  open -na WezTerm --args --config 'color_scheme="Batman"'
  yabai -m window "$id" --grid 1:3:2:0:1:1

elif [ "$is_visible" = "false" ]; then
  # if not visible, move the window to the current space and focus it
  yabai -m window "$id" --sub-layer above --toggle sticky --space mouse --focus

else
  # if visible, hide the window
  osascript -e "tell application \"System Events\" to set visible of first process Â¬" \
            -e "whose name is \"wezterm-gui\" to false"
fi
